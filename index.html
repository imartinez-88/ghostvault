<!DOCTYPE html>
<html lang="en">
 <head>
   <meta charset="UTF-8" />
   <title>GhostChain</title>
   <style>
     .grid {
       display: grid;
       grid-template-columns: repeat(3, 80px);
       grid-template-rows: repeat(3, 80px);
       gap: 10px;
       justify-content: center;
       margin: 20px 0;
     }


     .tile {
       background: #111;
       color: white;
       font-size: 24px;
       text-align: center;
       line-height: 80px;
       border-radius: 12px;
       user-select: none;
       cursor: pointer;
       transition: background 0.2s;
     }


     .tile.clicked {
       background: #44cc88;
     }
   </style>
 </head>


 <body>
   <h1>GhostKey Access System</h1>


   <!-- Key Management -->
   <button id="createKey" onclick="window.generateGhostKey()">Create GhostKey (Encrypted)</button>
   <button id="walleyKey">Connect Wallet to Create GhostKey</button>
   <button id="downloadKey">Download Key</button>

   <h2>Recover GhostVault (Private Key)</h2>
   <label>Vault File (.json):</label><br>
   <input type="file" id="vaultFile"><br><br>
   <label>Private Key File (.pem):</label><br>
   <input type="file" id="privateKeyFile"><br><br>
   <button id="goToVaultBtn" disabled> Gain Vault Access</button>


   <pre id="output"></pre>
    
   <script type="module" src="/src/main.js"></script>
  
   <script>
    const vaultFileInput = document.getElementById("vaultFile");
    const privateKeyInput = document.getElementById("privateKeyFile");
    const goBtn = document.getElementById("goToVaultBtn");
  
    function checkFiles() {
     const vaultFileValid = vaultFileInput.files.length && vaultFileInput.files[0].name.endsWith('.json');
     const keyFileValid = privateKeyInput.files.length && privateKeyInput.files[0].name.endsWith('.pem');;

     goBtn.disabled = !(vaultFileValid && keyFileValid);

     const output = document.getElementById("output");
     if (!goBtn.disabled) {
       output.textContent = "✅ Files ready. Click 'Gain Vault Access'.";
     } else if (vaultFileInput.files.length || privateKeyInput.files.length) {
       // Only show this if files are selected but invalid
       if ((vaultFileInput.files.length && !vaultFileValid) || (privateKeyInput.files.length && !keyFileValid)) {
         output.textContent = "❌ Please ensure the Vault File is .json and the Private Key File is .pem.";
       }
     } else {
       output.textContent = "";
     }
   }
     
    vaultFileInput.addEventListener("change", checkFiles);
    privateKeyInput.addEventListener("change", checkFiles);

    goBtn.onclick = () => {
        // Variable Names
        const vaultFile = vaultFileInput.files[0];
        const keyFile = privateKeyInput.files[0];

     if (vaultFile && keyFile) {
            const vaultReader = new FileReader();
            const keyReader = new FileReader(); 
     
            vaultReader.onload = (e) => {
                sessionStorage.setItem("vaultFileContent", e.target.result); // Use e.target.result
                checkAndRedirect();
            };
            vaultReader.readAsText(vaultFile);
 
            // onload function signature to accept the event 'e' 
            keyReader.onload = (e) => {
                // key for session storage 
                sessionStorage.setItem("privateKeyContent", e.target.result); // Use e.target.result
                checkAndRedirect();
            };
            keyReader.readAsText(keyFile);
 
            function checkAndRedirect() {
                if (sessionStorage.getItem("vaultFileContent") && sessionStorage.getItem("privateKeyContent")) {
                    window.location.href = "unlock.html";
                }
            }
        } else {
            // Optional: Alert the user if files weren't properly selected
            alert("Please select both the Vault File (.json) and Private Key (.pem).");
        }
    };
  </script>
 </body>
</html>
